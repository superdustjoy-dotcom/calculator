<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç”¢ç·šè¨ˆç®—æ©Ÿ V5.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body { background-color: #0f172a; color: #f3f4f6; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; overflow: hidden; touch-action: manipulation; display: flex; flex-direction: column; height: 100vh; }

        /* --- ä¸ŠåŠéƒ¨ï¼šé¡¯ç¤ºå€ --- */
        .content-area { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; }

        /* --- é ‚éƒ¨å¿«é€Ÿé¸å–® (Chips) --- */
        .chip-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 4px; scrollbar-width: none; }
        .chip-scroll::-webkit-scrollbar { display: none; }
        
        .chip {
            white-space: nowrap; background-color: #1e293b; color: #94a3b8; border: 1px solid #334155;
            padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; transition: all 0.2s; flex-shrink: 0;
        }
        .chip:active { transform: scale(0.95); }
        .chip.selected { background-color: #2563eb; border-color: #60a5fa; color: white; }

        /* --- è¼¸å…¥æ¡†æ¨£å¼ --- */
        .input-box { background-color: #1e293b; border-radius: 12px; padding: 8px 12px; margin-bottom: 8px; border: 2px solid #334155; transition: all 0.15s; }
        .input-box.active { border-color: #3b82f6; background-color: #172554; }
        
        .label { font-size: 0.75rem; color: #94a3b8; display: flex; justify-content: space-between; margin-bottom: 2px; }
        .active .label { color: #60a5fa; }
        
        .val-display { font-size: 1.6rem; font-weight: 700; color: white; min-height: 32px; display: flex; align-items: center; }
        .placeholder { color: #475569; font-weight: 400; font-size: 1.2rem; }

        /* --- è¨ˆç®—çµæœå€ --- */
        .calc-row { display: flex; gap: 8px; margin-bottom: 8px; }
        .calc-box { flex: 1; background: #334155; border-radius: 10px; padding: 8px 12px; border: 1px solid #475569; position: relative; }
        .calc-box.highlight { background: linear-gradient(135deg, #1e3a8a, #1e40af); border-color: #3b82f6; }
        
        .c-label { font-size: 0.7rem; color: #cbd5e1; }
        .c-val { font-size: 1.3rem; font-weight: 700; color: #fff; }
        .c-unit { font-size: 0.8rem; color: #94a3b8; margin-left: 4px; }

        /* --- åº•éƒ¨å„€è¡¨æ¿ --- */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: auto; padding-top: 10px; border-top: 1px solid #334155; }
        .card { background: #064e3b; border: 1px solid #059669; border-radius: 10px; padding: 8px; text-align: center; }
        .card-gray { background: #1f2937; border-color: #374151; }
        
        .d-title { font-size: 0.7rem; color: #a7f3d0; opacity: 0.9; }
        .d-val { font-size: 1.4rem; font-weight: 800; color: #fff; }
        .d-sub { font-size: 0.7rem; color: #6ee7b7; }

        /* --- éµç›¤å€ --- */
        .keypad { height: 40vh; background-color: #0f172a; border-top: 1px solid #334155; display: grid; grid-template-columns: repeat(4, 1fr); padding-bottom: env(safe-area-inset-bottom); }
        .key { background: #1e293b; color: #f8fafc; font-size: 1.5rem; font-weight: 600; border: 1px solid #0f172a; border-radius: 4px; margin: 1px; }
        .key:active { background: #475569; }
        .k-func { background: #334155; font-size: 1rem; color: #cbd5e1; }
        .k-del { color: #f87171; background: #334155; }
        .k-go { background: #2563eb; color: white; grid-row: span 2; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; line-height: 1.2; }
    </style>
</head>
<body onload="init()">

    <div class="content-area">
        <div class="flex justify-between items-center px-1 mb-1">
            <span class="text-xs text-gray-400">ğŸ”¢ é»æŒ‰éˆ•é¸è¦æ ¼ï¼Œæˆ–é»æ¡†æ¡†æ‰‹å‹•è¼¸å…¥</span>
            <button onclick="resetAll()" class="text-xs bg-gray-700 px-3 py-1 rounded-full text-gray-300">é‡ç½®</button>
        </div>

        <div class="chip-scroll">
            <button class="chip" onclick="quickSetSpec('60')">60ç“¶</button>
            <button class="chip" onclick="quickSetSpec('70')">70ç“¶</button> <button class="chip" onclick="quickSetSpec('84')">84ç“¶</button>
            <button class="chip" onclick="quickSetSpec('100')">100ç“¶</button>
            <button class="chip" onclick="quickSetSpec('12')">12 (ä¸¸)</button>
            <button class="chip" onclick="quickSetSpec('6')">6 (Kè£)</button>
        </div>

        <div class="input-box" id="box-spec" onclick="focusField('spec')">
            <div class="label">ğŸ“¦ 0. è¦æ ¼ (å¯è‡ªå¡«/é¸å¡«)</div>
            <div class="val-display" id="val-spec">60</div>
        </div>

        <div class="input-box" id="box-in" onclick="focusField('in')">
            <div class="label">âš–ï¸ 1. åˆ†è£ç§»å…¥é‡ (Kg)</div>
            <div class="val-display placeholder" id="val-in">é»æ“Šè¼¸å…¥...</div>
        </div>

        <div class="input-box" id="box-avg" onclick="focusField('avg')">
            <div class="label">ğŸ“ 2. å¹³å‡è£é‡ (g/ç“¶)</div>
            <div class="val-display placeholder" id="val-avg">é»æ“Šè¼¸å…¥...</div>
        </div>

        <div class="input-box active" id="box-bottles" onclick="focusField('bottles')">
            <div class="label">ğŸ’Š 3. æˆå“ç¸½æ•¸ (ç“¶/ç›’)</div>
            <div class="val-display placeholder" id="val-bottles">é»æ“Šè¼¸å…¥...</div>
        </div>

        <div class="calc-row">
            <div class="calc-box highlight">
                <div class="c-label">åˆ†è£ç¸½é‡ (Avg Ã— æ•¸é‡)</div>
                <div><span class="c-val" id="res-total">-</span><span class="c-unit">Kg</span></div>
            </div>
            <div class="calc-box">
                <div class="c-label">ç†è«–å‰©é¤˜ (ç§»å…¥ - ç¸½é‡)</div>
                <div><span class="c-val" id="res-remain">-</span><span class="c-unit">Kg</span></div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card card-gray">
                <div class="d-title">å…¥åº«ç®±æ•¸</div>
                <div class="d-val" id="res-box">-</div>
                <div class="d-sub" id="res-box-det"></div>
            </div>
            <div class="card" id="card-yield">
                <div class="d-title">ç”¢ç‡ (%)</div>
                <div class="d-val" id="res-yield">-</div>
            </div>
        </div>
    </div>

    <div class="keypad">
        <button class="key" onclick="press('7')">7</button>
        <button class="key" onclick="press('8')">8</button>
        <button class="key" onclick="press('9')">9</button>
        <button class="key k-del" onclick="del()">âŒ«</button>

        <button class="key" onclick="press('4')">4</button>
        <button class="key" onclick="press('5')">5</button>
        <button class="key" onclick="press('6')">6</button>
        <button class="key k-func" onclick="clearField()">C</button>

        <button class="key" onclick="press('1')">1</button>
        <button class="key" onclick="press('2')">2</button>
        <button class="key" onclick="press('3')">3</button>
        <button class="key k-go" onclick="next()">ä¸‹ä¸€å€‹<br>â–¼</button>

        <button class="key" onclick="press('0')">0</button>
        <button class="key" onclick="press('.')">.</button>
        <button class="key k-func" onclick="prev()">â–²</button>
    </div>

    <script>
        // --- ç‹€æ…‹ç®¡ç† ---
        let curr = 'bottles'; 
        // ç‚ºäº†æ–¹ä¾¿ï¼Œé€™è£¡è¨­å®šéµç›¤çš„ã€Œä¸‹ä¸€å€‹ã€æŒ‰éµå¾ªç’°é †åº
        // å¦‚æœæ‚¨æƒ³è¦æŒ‰ã€Œä¸‹ä¸€å€‹ã€èƒ½è·³åˆ°è¦æ ¼æ ¼ï¼Œå¯ä»¥æŠŠ 'spec' åŠ é€²å»
        // ç›®å‰è¨­å®šï¼šç§»å…¥ -> å¹³å‡ -> æ•¸é‡ -> å›åˆ°ç§»å…¥ (è¦æ ¼é€šå¸¸è¨­å®šä¸€æ¬¡ä¸å‹•ï¼Œæ‰€ä»¥ä¸æ”¾é€²å¾ªç’°ï¼Œé¿å…ä¸€ç›´è·³ä¸Šå»)
        const order = ['in', 'avg', 'bottles']; 
        
        const data = { spec: '60', in: '', avg: '', bottles: '' };
        
        // --- DOM ---
        const els = {
            spec: document.getElementById('val-spec'),
            in: document.getElementById('val-in'),
            avg: document.getElementById('val-avg'),
            bottles: document.getElementById('val-bottles'),
            
            // çµæœé¡¯ç¤º
            resTotal: document.getElementById('res-total'),
            resRemain: document.getElementById('res-remain'),
            resBox: document.getElementById('res-box'),
            resBoxDet: document.getElementById('res-box-det'),
            resYield: document.getElementById('res-yield'),
            cardYield: document.getElementById('card-yield')
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            const saved = localStorage.getItem('v51_spec');
            if(saved) quickSetSpec(saved);
            focusField('bottles');
        }

        // --- äº’å‹•é‚è¼¯ ---
        function focusField(id) {
            curr = id;
            // ç§»é™¤æ‰€æœ‰ active
            ['spec', 'in', 'avg', 'bottles'].forEach(k => {
                const el = document.getElementById('box-'+k);
                if(el) el.classList.remove('active');
            });
            // åŠ å…¥ç•¶å‰ active
            document.getElementById('box-'+id).classList.add('active');
        }

        function quickSetSpec(val) {
            data.spec = val;
            els.spec.innerText = val;
            
            document.querySelectorAll('.chip').forEach(btn => {
                if(btn.innerText.includes(val)) btn.classList.add('selected');
                else btn.classList.remove('selected');
            });
            calc();
        }

        // --- éµç›¤é‚è¼¯ ---
        function press(key) {
            let val = data[curr];
            if(key === '.' && val.includes('.')) return;
            if(val.length > 8) return;
            data[curr] += key;
            updateView(curr);
            calc();
        }

        function del() {
            data[curr] = data[curr].slice(0, -1);
            updateView(curr);
            calc();
        }

        function clearField() {
            data[curr] = '';
            updateView(curr);
            calc();
        }

        function next() {
            let idx = order.indexOf(curr);
            if (idx === -1) {
                // å¦‚æœç¾åœ¨åœåœ¨ spec (ä¸åœ¨å¾ªç’°å…§)ï¼ŒæŒ‰ä¸‹ä¸€æ ¼å» 'in'
                focusField('in');
            } else {
                focusField(order[(idx + 1) % order.length]);
            }
        }
        function prev() {
            let idx = order.indexOf(curr);
            if (idx === -1) {
                 focusField('bottles');
            } else {
                focusField(order[(idx - 1 + order.length) % order.length]);
            }
        }

        function updateView(id) {
            const el = els[id];
            const val = data[id];
            if(val === '') {
                // å¦‚æœæ˜¯è¦æ ¼ï¼Œç©ºå€¼é¡¯ç¤º 0 æˆ–æç¤ºï¼Œå…¶ä»–é¡¯ç¤º placeholder
                if(id === 'spec') {
                    el.innerText = 'è¼¸å…¥...';
                    el.classList.add('placeholder');
                } else {
                    el.innerText = 'é»æ“Šè¼¸å…¥...';
                    el.classList.add('placeholder');
                }
            } else {
                el.innerText = val;
                el.classList.remove('placeholder');
            }
        }

        // --- æ ¸å¿ƒè¨ˆç®— ---
        function calc() {
            localStorage.setItem('v51_spec', data.spec);

            const spec = parseFloat(data.spec) || 0;
            const i = parseFloat(data.in) || 0;     // ç§»å…¥é‡
            const a = parseFloat(data.avg) || 0;    // å¹³å‡é‡ (g)
            const b = parseFloat(data.bottles) || 0;// æˆå“æ•¸

            // 1. è¨ˆç®—ç¸½é‡ (Total Weight) = Avg(g) * Bottles / 1000
            let totalKg = 0;
            if(a > 0 && b > 0) {
                totalKg = (a * b) / 1000;
                els.resTotal.innerText = totalKg.toFixed(2);
            } else {
                els.resTotal.innerText = "-";
            }

            // 2. è¨ˆç®—å‰©é¤˜ (Remaining) = Input - Total
            if(i > 0 && totalKg > 0) {
                const remain = i - totalKg;
                els.resRemain.innerText = remain.toFixed(2);
                if(remain < 0) els.resRemain.style.color = "#f87171";
                else els.resRemain.style.color = "#fff";
            } else {
                els.resRemain.innerText = "-";
            }

            // 3. è¨ˆç®—ç”¢ç‡ (Yield) = Total / Input
            if(i > 0 && totalKg > 0) {
                const y = (totalKg / i) * 100;
                els.resYield.innerText = y.toFixed(2) + "%";
                if(y < 98 || y > 102) {
                    els.cardYield.style.background = "#7f1d1d";
                    els.cardYield.style.borderColor = "#f87171";
                } else {
                    els.cardYield.style.background = "#064e3b";
                    els.cardYield.style.borderColor = "#059669";
                }
            } else {
                els.resYield.innerText = "-";
                els.cardYield.style.background = "#064e3b";
            }

            // 4. è¨ˆç®—ç®±æ•¸
            if(spec > 0 && b > 0) {
                const full = Math.floor(b / spec);
                const rem = b % spec;
                const totalBox = rem > 0 ? full + 1 : full;
                els.resBox.innerText = totalBox + " ç®±";
                els.resBoxDet.innerText = `(${full}æ•´ + é¤˜${rem})`;
            } else {
                els.resBox.innerText = "-";
                els.resBoxDet.innerText = "";
            }
        }

        function resetAll() {
            data.in = ''; data.avg = ''; data.bottles = '';
            // ä¸æ¸…ç©º spec
            updateView('in'); updateView('avg'); updateView('bottles');
            focusField('bottles');
            calc();
        }
    </script>
</body>
</html>
